<div class="note-card-container" [class.editing]="isEditing">
  @if (note.selectedText) {
  <div class="note-quote">
    <div class="quote-stripe"></div>
    <lucide-icon [img]="Icons.MessageSquareQuote" [size]="14" class="quote-icon"></lucide-icon>
    <p class="quote-text">"{{ note.selectedText }}"</p>
  </div>
  } @if (isEditing) {
  <div class="edit-box" (click)="$event.stopPropagation()">
    <app-concept-input
      [(ngModel)]="editContent"
      [rows]="3"
      (submitTrigger)="saveEdit()"
    ></app-concept-input>

    <div class="edit-actions">
      <button class="icon-btn small" (click)="saveEdit($event)" title="Save">
        <lucide-icon [img]="Icons.Check" [size]="16"></lucide-icon>
      </button>
      <button class="icon-btn small" (click)="cancelEdit($event)" title="Cancel">
        <lucide-icon [img]="Icons.Close" [size]="16"></lucide-icon>
      </button>
    </div>
  </div>
  } @else {
  <div class="content-row">
    @if (note.content) {
    <p
      class="note-text"
      [innerHTML]="note.content | noteFormat : conceptMap"
      (click)="onContentClick($event)"
    ></p>
    } @else {
    <p class="note-meta-placeholder">No additional comment</p>
    }

    <div class="note-footer">
      <span class="note-date">{{ note.createdAt | date : 'short' }}</span>

      @if (showNavigation || showActions) {
      <div class="note-actions">
        @if (showNavigation) {
        <button class="icon-btn xs" (click)="onCardClick($event)" title="Jump to location">
          <lucide-icon [img]="Icons.ArrowRight" [size]="14"></lucide-icon>
        </button>
        } @if (showActions) {
        <button class="icon-btn xs" (click)="startEdit($event)">
          <lucide-icon [img]="Icons.Edit" [size]="14"></lucide-icon>
        </button>
        <button class="icon-btn xs delete" (click)="onDelete($event)">
          <lucide-icon [img]="Icons.Delete" [size]="14"></lucide-icon>
        </button>
        }
      </div>
      }
    </div>
  </div>
  }
</div>
