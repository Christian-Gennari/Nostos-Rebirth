<button class="floating-toggle" (click)="toggle()" [class.hidden]="expanded()">
  <lucide-icon [img]="MenuIcon" [size]="24"></lucide-icon>
</button>

<nav class="sidebar" [class.collapsed]="!expanded()" [class.collapsing]="collapseSidebarProgress()">
  <div class="sidebar-header">
    @if (expanded()) {
    <img class="brand-icon" src="/logo_idea_pure-black.png" alt="logo" />
    <div class="brand" animate.enter="fade-in">Nostos</div>

    } @else {
    <img class="brand-icon" src="/logo_idea_pure-black.png" alt="logo" />
    }
  </div>

  <div class="nav-scroll-area">
    <div class="nav-group">
      <button
        class="nav-item"
        routerLink="/library"
        [queryParams]="{}"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        (click)="activeId.set(null)"
        title="All Books"
      >
        <lucide-icon [img]="LibraryIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">All Books</span> }
      </button>

      <button
        class="nav-item"
        routerLink="/library"
        [queryParams]="{ filter: 'reading' }"
        routerLinkActive="active"
        (click)="activeId.set(null)"
        title="Continue Reading"
      >
        <lucide-icon [img]="BookOpenIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">Reading</span> }
      </button>

      <button
        class="nav-item"
        routerLink="/library"
        [queryParams]="{ filter: 'favorites' }"
        routerLinkActive="active"
        (click)="activeId.set(null)"
        title="Favorites"
      >
        <lucide-icon [img]="HeartIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">Favorites</span> }
      </button>

      <button
        class="nav-item"
        routerLink="/library"
        [queryParams]="{ filter: 'finished' }"
        routerLinkActive="active"
        (click)="activeId.set(null)"
        title="Finished"
      >
        <lucide-icon [img]="CheckCircleIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">Finished</span> }
      </button>

      <button
        class="nav-item"
        routerLink="/library"
        [queryParams]="{ filter: 'unsorted' }"
        routerLinkActive="active"
        (click)="activeId.set(null)"
        title="Unsorted"
      >
        <lucide-icon [img]="InboxIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">Unsorted</span> }
      </button>
    </div>

    <div class="nav-group">
      @if (expanded()) {
      <div class="section-label" style="margin-top: 1rem">Apps</div>
      }
      <button
        class="nav-item"
        routerLink="/second-brain"
        (click)="activeId.set(null)"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        title="The Brain"
      >
        <lucide-icon [img]="BrainIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">The Brain</span> }
      </button>

      <button
        class="nav-item"
        routerLink="/studio"
        (click)="activeId.set(null)"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        title="Writing Studio"
      >
        <lucide-icon [img]="PenToolIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">Writing Studio</span> }
      </button>
    </div>

    <div class="nav-group">
      @if (expanded()) {
      <div class="section-label" animate.enter="fade-in" style="margin-top: 1rem">Collections</div>

      <div
        cdkDropList
        id="root-list"
        [cdkDropListData]="collections()"
        [cdkDropListConnectedTo]="connectedDropLists()"
        (cdkDropListDropped)="onRootDrop($event)"
        class="root-drop-list"
        [style.min-height]="'50px'"
      >
        @for (col of collections(); track col.id) { @if (editingId() === col.id) {
        <div class="nav-item input-mode">
          <lucide-icon [img]="FolderIcon" [size]="18" strokeWidth="2"></lucide-icon>
          <input
            #editInput
            type="text"
            class="sidebar-input"
            [value]="col.name"
            (keydown.enter)="saveRename(col.id, editInput.value)"
            (keydown.escape)="cancelRename()"
            autoFocus
          />
        </div>
        } @else {
        <app-tree-node
          [item]="col"
          [level]="0"
          [activeId]="activeId()"
          [connectedDropLists]="connectedDropLists()"
          [editable]="true"
          (nodeSelected)="select($event.id)"
          (nodeMoved)="onItemMoved($event)"
          (nodeRenamed)="startRename($event)"
          (nodeDeleted)="deleteCollection($event)"
        ></app-tree-node>
        } }
      </div>
      }
    </div>

    <div class="nav-group mt-auto">
      @if (adding()) {
      <div class="nav-item input-mode">
        <lucide-icon [img]="PlusIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) {
        <input
          type="text"
          class="sidebar-input"
          [(ngModel)]="newName"
          (keydown.enter)="create()"
          (keydown.escape)="resetInput()"
          placeholder="Name..."
          autoFocus
        />
        }
      </div>
      } @else {
      <button class="nav-item action-add" (click)="startAdd()" title="Create Collection">
        <lucide-icon [img]="PlusIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) {
        <span class="label">New Collection</span>
        }
      </button>
      }
    </div>
  </div>

  <div class="sidebar-footer">
    <button class="toggle-btn" (click)="toggle()">
      @if (expanded()) {
      <lucide-icon [img]="PanelLeftCloseIcon" [size]="18" strokeWidth="1.5"></lucide-icon>
      } @else {
      <lucide-icon [img]="PanelLeftOpenIcon" [size]="18" strokeWidth="1.5"></lucide-icon>
      }
    </button>
  </div>
</nav>
