<nav class="sidebar" [class.collapsed]="!expanded()" [class.collapsing]="collapseSidebarProgress()">
  <div class="sidebar-header">
    @if (expanded()) {
    <img class="brand-icon" src="/logo_idea_pure-black.png" alt="logo">
    <div class="brand" animate.enter="fade-in">Nostos</div>

    } @else {
    <img class="brand-icon" src="/logo_idea_pure-black.png" alt="logo">
    }
  </div>

  <div class="nav-scroll-area">
    <div class="nav-group">
      <button class="nav-item" routerLink="/library" #rlaAllBooks="routerLinkActive" routerLinkActive="tmp-active"
        [routerLinkActiveOptions]="{ exact: true }" (click)="activeId.set(null)"
        [class.active]="rlaAllBooks.isActive && activeId() === null" title="All Books">
        <lucide-icon [img]="LibraryIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">All Books</span> }
      </button>
    </div>

    <div class="nav-group">
      <button class="nav-item" routerLink="/second-brain" (click)="activeId.set(null)" routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }" title="The Brain">
        <lucide-icon [img]="BrainIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) { <span class="label">The Brain</span> }
      </button>
    </div>

    <div class="nav-group">
      @if (expanded()) {
      <div class="section-label" animate.enter="fade-in">Collections</div>
      } @for (col of collections(); track col.id) { @if (editingId() === col.id) {
      <div class="nav-item input-mode">
        <lucide-icon [img]="FolderIcon" [size]="18" strokeWidth="2"></lucide-icon>
        <input #editInput type="text" class="sidebar-input" [value]="col.name"
          (keydown.enter)="saveRename(col.id, editInput.value)" (keydown.escape)="cancelRename()" autoFocus />
      </div>
      } @else {
      <div class="nav-item-row" [class.active]="activeId() === col.id" (click)="select(col.id)">
        <div class="nav-content">
          <lucide-icon [img]="FolderIcon" [size]="18" strokeWidth="2"></lucide-icon>
          @if (expanded()) {
          <span class="label truncate">{{ col.name }}</span>
          }
        </div>

        @if (expanded()) {
        <div class="nav-actions" (click)="$event.stopPropagation()">
          <button class="action-mini" (click)="startRename(col)" title="Rename">
            <lucide-icon [img]="Edit2Icon" [size]="12"></lucide-icon>
          </button>
          <button class="action-mini danger" (click)="deleteCollection(col.id)" title="Delete">
            <lucide-icon [img]="Trash2Icon" [size]="12"></lucide-icon>
          </button>
        </div>
        }
      </div>
      } }
    </div>

    <div class="nav-group mt-auto">
      @if (adding()) {
      <div class="nav-item input-mode">
        <lucide-icon [img]="PlusIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) {
        <input type="text" class="sidebar-input" [(ngModel)]="newName" (keydown.enter)="create()"
          (keydown.escape)="resetInput()" placeholder="Name..." autoFocus />
        }
      </div>
      } @else {
      <button class="nav-item action-add" (click)="startAdd()" title="Create Collection">
        <lucide-icon [img]="PlusIcon" [size]="18" strokeWidth="2"></lucide-icon>
        @if (expanded()) {
        <span class="label">New Collection</span>
        }
      </button>
      }
    </div>
  </div>

  <div class="sidebar-footer">
    <button class="toggle-btn" (click)="toggle()">
      @if (expanded()) {
      <lucide-icon [img]="PanelLeftCloseIcon" [size]="18" strokeWidth="1.5"></lucide-icon>
      } @else {
      <lucide-icon [img]="PanelLeftOpenIcon" [size]="18" strokeWidth="1.5"></lucide-icon>
      }
    </button>
  </div>
</nav>
