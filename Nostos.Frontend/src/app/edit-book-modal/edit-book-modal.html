@if (isOpen()) {
<div class="modal-overlay" (click)="closeModal.emit()">
  <div class="modal-content large" (click)="$event.stopPropagation()">

    <div class="modal-header">
      <h3>Edit Metadata</h3>
      <button class="icon-btn" (click)="closeModal.emit()">
        <lucide-icon [img]="XIcon" [size]="20"></lucide-icon>
      </button>
    </div>

    <div class="modal-body">
      <!-- Title & Subtitle -->
      <div class="grid grid-2">
        <div class="form-group">
          <label>Title</label>
          <input class="input" [(ngModel)]="form.title" />
        </div>
        <div class="form-group">
          <label>Subtitle</label>
          <input class="input" [(ngModel)]="form.subtitle" placeholder="Optional subtitle" />
        </div>
      </div>

      <!-- Author -->
      <div class="form-group mb-1">
        <label>Author</label>
        <input class="input" [(ngModel)]="form.author" />
      </div>

      <!-- Series Info -->
      <div class="grid grid-3">
        <div class="form-group">
          <label>Series</label>
          <input class="input" [(ngModel)]="form.series" placeholder="Series Name" />
        </div>
        <div class="form-group">
          <label>Volume</label>
          <input class="input" [(ngModel)]="form.volumeNumber" placeholder="#" />
        </div>
        <div class="form-group">
          <label>Language</label>
          <input class="input" [(ngModel)]="form.language" placeholder="en" />
        </div>
      </div>

      <!-- Publishing Info -->
      <div class="grid grid-3">
        <div class="form-group">
          <label>Publisher</label>
          <input class="input" [(ngModel)]="form.publisher" />
        </div>
        <div class="form-group">
          <label>Date</label>
          <input class="input" type="date" [(ngModel)]="form.publicationDate" />
        </div>
        <div class="form-group">
          <label>Pages</label>
          <input class="input" type="number" [(ngModel)]="form.pageCount" />
        </div>
      </div>

      <!-- Collection & ISBN & Categories -->
      <div class="grid grid-2">
        <div class="form-group">
          <label>ISBN</label>
          <input class="input" [(ngModel)]="form.isbn" />
        </div>
        <div class="form-group">
          <label>Collection</label>
          <div class="select-wrapper">
            <select class="input select-input" [(ngModel)]="form.collectionId">
              <option [ngValue]="null">No Collection</option>
              <option *ngFor="let col of collections()" [value]="col.id">
                {{ col.name }}
              </option>
            </select>
            <lucide-icon class="sel-icon" [img]="ChevronDownIcon" [size]="16"></lucide-icon>
          </div>
        </div>
      </div>

      <div class="form-group mb-1">
        <label>Genres / Categories</label>
        <input class="input" [(ngModel)]="form.categories" placeholder="Comma separated values" />
      </div>

      <!-- Description -->
      <div class="form-group">
        <label>Synopsis</label>
        <textarea class="input" rows="5" [(ngModel)]="form.description"></textarea>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="closeModal.emit()">Cancel</button>
      <button class="btn btn-primary" (click)="save()">Save Changes</button>
    </div>

  </div>
</div>
}
